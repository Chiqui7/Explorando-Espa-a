<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Explorando España</title>

  <!-- Librería para generar PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    :root {
      --bg: #FDF5E6;          /* arena suave */
      --text: #1C3D5A;        /* azul mar */
      --accent: #77C9D4;      /* turquesa */
      --accent-dark: #57A99A; /* verde palmera */
      --success: #D4FFD8;     /* verde suave éxito */
      --card: #FFFFFF;
      --shadow: 0 2px 6px rgba(0,0,0,0.06);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      text-align: center;
    }

    h1 {
      margin-top: 20px;
      margin-bottom: 8px;
    }

    p.subtitle {
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 14px;
      opacity: 0.8;
    }

    button {
      padding: 14px 26px;
      margin: 10px;
      font-size: 18px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.1s ease;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.12);
    }

    #freePlanBtn {
      background: #E9DAC4;
      color: var(--text);
    }

    #personalPlanBtn {
      background: var(--accent);
      color: #ffffff;
    }

    .container {
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
    }

    .hidden {
      display: none;
    }

    /* PLAN GRATUITO */

    .ccaa-section {
      text-align: left;
      background: var(--card);
      padding: 15px;
      margin-top: 10px;
      border-radius: 8px;
      box-shadow: var(--shadow);
    }

    .ccaa-title {
      cursor: pointer;
      font-weight: bold;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .ccaa-title span {
      font-size: 18px;
    }

    .city-list {
      display: none;
      margin-left: 8px;
      margin-top: 8px;
    }

    .city {
      display: inline-block;
      cursor: pointer;
      margin: 3px 6px 3px 0;
      padding: 4px 10px;
      border-radius: 999px;
      background: #E5F7FA;
      color: var(--accent-dark);
      font-size: 13px;
    }

    .city:hover {
      background: #dbeff4;
    }

    .info-box {
      margin-top: 10px;
      padding: 10px;
      background: #E5F7FA;
      border-radius: 6px;
      font-size: 13px;
    }

    .info-box strong {
      display: inline-block;
      margin-top: 3px;
    }

    /* PLAN PERSONALIZADO */

    .question-box {
      background: var(--card);
      padding: 20px;
      border-radius: 10px;
      margin-top: 30px;
      text-align: left;
      box-shadow: var(--shadow);
    }

    .question-box h3 {
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 18px;
    }

    .question-box label {
      font-size: 14px;
      display: block;
      margin-bottom: 5px;
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 4px;
      margin-bottom: 20px;
      border-radius: 6px;
      border: 1px solid #aaa;
      font-size: 14px;
    }

    .daterange {
      display: flex;
      gap: 10px;
    }

    .daterange div {
      flex: 1;
    }

    .back-btn {
      background: var(--text);
      color: white;
      margin-right: 10px;
      font-size: 16px;
    }

    .next-btn {
      background: var(--accent);
      color: white;
      font-size: 16px;
    }

    .progress-wrapper {
      margin-top: 20px;
      text-align: left;
      font-size: 12px;
      opacity: 0.8;
    }

    .progress-bar-bg {
      width: 100%;
      height: 6px;
      background: #E9DAC4;
      border-radius: 999px;
      overflow: hidden;
      margin-top: 4px;
    }

    .progress-bar-fill {
      height: 6px;
      width: 0;
      background: var(--accent);
      border-radius: 999px;
      transition: width 0.2s ease;
    }

    .conditions-box {
      background: var(--card);
      padding: 20px;
      border-radius: 10px;
      margin-top: 30px;
      text-align: left;
      box-shadow: var(--shadow);
      font-size: 14px;
    }

    .conditions-box ul {
      padding-left: 20px;
    }

    .conditions-box li {
      margin-bottom: 6px;
    }

    .conditions-actions {
      margin-top: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .conditions-actions input[type="checkbox"] {
      width: auto;
      margin: 0;
    }

    .conditions-actions label {
      margin: 0;
    }

    #confirmationMessage {
      margin-top: 20px;
      background: var(--success);
      padding: 20px;
      border-radius: 10px;
      font-size: 14px;
      text-align: left;
    }

    #confirmationMessage strong {
      display: block;
      margin-bottom: 6px;
    }

    iframe {
      width: 100%;
      height: 400px;
      border: 0;
      margin-top: 30px;
      border-radius: 10px;
    }

    /* Pequeño texto legal bajo el cuestionario */
    .privacy-note {
      margin-top: 10px;
      font-size: 11px;
      color: rgba(0,0,0,0.6);
    }

    @media (max-width: 600px) {
      .container {
        padding: 10px;
      }

      button {
        width: 90%;
        max-width: 320px;
      }

      .daterange {
        flex-direction: column;
      }
    }
  </style>
</head>

<body>

  <h1>Explorando España</h1>
  <p class="subtitle">
    Planes por España creados con IA y revisión humana. Elige inspiración gratis o tu viaje perfecto en menos de 24h.
  </p>

  <!-- BOTONES PRINCIPALES -->
  <button id="freePlanBtn">PLAN GRATUITO</button>
  <button id="personalPlanBtn">PLAN PERSONALIZADO</button>

  <!-- CONTENEDORES DE CADA PLAN -->
  <div id="freePlan" class="container hidden"></div>
  <div id="personalPlan" class="container hidden"></div>

  <!-- MAPA DE ESPAÑA, SIEMPRE ABAJO -->
  <iframe
    loading="lazy"
    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d4889502.373868815!2d-9.556876061667067!3d40.20847784486433!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0xd6b61b4f20bb6c3%3A0x10340f3c9caa480!2sEspaña!5e0!3m2!1ses!2ses!4v1700000000000">
  </iframe>

  <script>
    const DESTINO_EMAIL = "contacto.adriangilj@gmail.com";

    const freePlanBtn = document.getElementById("freePlanBtn");
    const personalPlanBtn = document.getElementById("personalPlanBtn");
    const freePlanContainer = document.getElementById("freePlan");
    const personalPlanContainer = document.getElementById("personalPlan");

    // ============================================================
    //   PLAN GRATUITO: CCAA + CIUDADES + INFO
    // ============================================================

    const ccaaData = {
      "Andalucía": [
        "Sevilla",
        "Málaga",
        "Cádiz",
        "Granada",
        "Córdoba",
        "Almería",
        "Huelva",
        "Jaén"
      ],
      "Cataluña": [
        "Barcelona",
        "Girona (Costa Brava)",
        "Tarragona (Costa Dorada)",
        "Lleida (Pirineo)"
      ],
      "Comunidad de Madrid": [
        "Madrid",
        "Sierra de Guadarrama"
      ],
      "Comunidad Valenciana": [
        "Valencia",
        "Alicante (Costa Blanca)",
        "Castellón",
        "Dénia"
      ],
      "País Vasco": [
        "Bilbao",
        "San Sebastián",
        "Vitoria-Gasteiz",
        "Costa vasca"
      ],
      "Galicia": [
        "Santiago de Compostela",
        "A Coruña",
        "Vigo (Rías Baixas)",
        "Lugo",
        "Ourense"
      ],
      "Islas Baleares": [
        "Mallorca",
        "Ibiza",
        "Menorca",
        "Formentera"
      ],
      "Islas Canarias": [
        "Tenerife",
        "Gran Canaria",
        "Lanzarote",
        "Fuerteventura",
        "La Palma"
      ],
      "Murcia": [
        "Murcia",
        "Cartagena",
        "La Manga"
      ],
      "Navarra": [
        "Pamplona",
        "Pirineo navarro"
      ],
      "Aragón": [
        "Zaragoza",
        "Huesca (Pirineo)",
        "Teruel"
      ],
      "Castilla y León": [
        "Salamanca",
        "Segovia",
        "Ávila",
        "León",
        "Burgos",
        "Valladolid"
      ],
      "Castilla-La Mancha": [
        "Toledo",
        "Cuenca",
        "Albacete",
        "Ciudad Real",
        "Guadalajara"
      ],
      "Asturias": [
        "Oviedo",
        "Gijón",
        "Cudillero",
        "Ribadesella"
      ],
      "Cantabria": [
        "Santander",
        "Picos de Europa (zona cántabra)"
      ],
      "La Rioja": [
        "Logroño",
        "Ruta del vino en La Rioja"
      ],
      "Extremadura": [
        "Cáceres",
        "Mérida",
        "Badajoz"
      ],
      "Ceuta y Melilla": [
        "Ceuta",
        "Melilla"
      ]
    };

    const cityInfo = {
      "Sevilla": `
        <strong>Actividades:</strong> Catedral y Giralda, Real Alcázar, Plaza de España, paseo por el Barrio de Santa Cruz.<br>
        <strong>Hoteles:</strong> Hoteles boutique cerca de la Catedral, alojamientos con terraza en Triana y centro.<br>
        <strong>Transporte:</strong> AVE con Madrid y Barcelona, tranvía y buses; casco histórico a pie.<br>
        <strong>Fiesta:</strong> Triana (Betis y Pureza), Alameda de Hércules, tablaos flamencos.
      `,
      "Málaga": `
        <strong>Actividades:</strong> Alcazaba, Gibralfaro, Muelle Uno, Museo Picasso, playas de la Malagueta y Pedregalejo.<br>
        <strong>Hoteles:</strong> Hoteles de ciudad en el centro, hoteles con rooftop en Soho y resorts de playa.<br>
        <strong>Transporte:</strong> Aeropuerto bien conectado, cercanías a la costa, autobuses urbanos.<br>
        <strong>Fiesta:</strong> Bares del centro, Soho y chiringuitos con música.
      `,
      "Cádiz": `
        <strong>Actividades:</strong> Casco histórico, playa de La Caleta, castillos y excursiones a la Costa de la Luz.<br>
        <strong>Hoteles:</strong> Hoteles pequeños en el casco antiguo y resorts en Zahara, Conil, Chiclana.<br>
        <strong>Transporte:</strong> Tren desde Sevilla, coche ideal para hacer ruta de playas.<br>
        <strong>Fiesta:</strong> Terrazas en el casco antiguo y bares frente al mar.
      `,
      "Granada": `
        <strong>Actividades:</strong> Alhambra, Albaicín, Sacromonte, mirador de San Nicolás y ruta de tapas.<br>
        <strong>Hoteles:</strong> Zona Catedral, Realejo y hoteles con vistas a la Alhambra.<br>
        <strong>Transporte:</strong> Ciudad muy caminable; buses urbanos y acceso a Sierra Nevada.<br>
        <strong>Fiesta:</strong> Bares de tapas en el centro y ambiente universitario.
      `,
      "Córdoba": `
        <strong>Actividades:</strong> Mezquita-Catedral, Judería, patios cordobeses, Medina Azahara.<br>
        <strong>Hoteles:</strong> Alojamiento en la Judería y hoteles con patio andaluz.<br>
        <strong>Transporte:</strong> AVE y ciudad pensada para recorrer a pie.<br>
        <strong>Fiesta:</strong> Terrazas junto al río y bares en el centro.
      `,
      "Barcelona": `
        <strong>Actividades:</strong> Sagrada Familia, Park Güell, Casa Batlló, Born y Gòtic, playas de Barceloneta y Port Olímpic.<br>
        <strong>Hoteles:</strong> Eixample para moverse bien, hoteles frente al mar en Barceloneta.<br>
        <strong>Transporte:</strong> Metro y buses muy completos.<br>
        <strong>Fiesta:</strong> Bares y clubs en Port Olímpic, El Born, Poble-sec y salas como Razzmatazz.
      `,
      "Girona (Costa Brava)": `
        <strong>Actividades:</strong> Casco medieval de Girona, pueblos como Tossa, Calella, Begur o Cadaqués y calas de agua turquesa.<br>
        <strong>Hoteles:</strong> Hoteles en Girona ciudad, casas rurales y alojamientos costeros.<br>
        <strong>Transporte:</strong> Tren a Girona; coche muy recomendable para moverse por la costa.<br>
        <strong>Fiesta:</strong> Chiringuitos y bares frente al mar con ambiente relajado.
      `,
      "Madrid": `
        <strong>Actividades:</strong> Prado, Reina Sofía, Thyssen, Retiro, Palacio Real, barrios como Malasaña, Chueca y La Latina.<br>
        <strong>Hoteles:</strong> Gran Vía, Sol y Huertas para estar en el centro, Chamberí para algo más tranquilo.<br>
        <strong>Transporte:</strong> Metro y cercanías, no necesitas coche.<br>
        <strong>Fiesta:</strong> Malasaña y Chueca, azoteas en Gran Vía y zona de Huertas/La Latina.
      `,
      "Valencia": `
        <strong>Actividades:</strong> Ciudad de las Artes y las Ciencias, casco antiguo, Turia, playas de Malvarrosa y Patacona, Albufera.<br>
        <strong>Hoteles:</strong> Centro para combinar cultura y ocio, alojamientos frente al mar.<br>
        <strong>Transporte:</strong> Metro, tranvía y bici.<br>
        <strong>Fiesta:</strong> Ruzafa y Cánovas, locales en Marina y paseo marítimo.
      `,
      "Alicante (Costa Blanca)": `
        <strong>Actividades:</strong> Castillo de Santa Bárbara, casco antiguo, Explanada y excursiones por la Costa Blanca (Altea, Calpe, Benidorm).<br>
        <strong>Hoteles:</strong> Hoteles y apartamentos frente al mar, alojamientos en el centro y puerto.<br>
        <strong>Transporte:</strong> Aeropuerto cercano, tranvía TRAM por la costa.<br>
        <strong>Fiesta:</strong> Bares y discotecas junto al puerto y playa.
      `,
      "Dénia": `
        <strong>Actividades:</strong> Playas de Les Marines y Les Rotes, castillo, Montgó y paseos en barco hacia Ibiza y Formentera.<br>
        <strong>Hoteles:</strong> Apartamentos y hoteles frente al mar, casas rurales en interior.<br>
        <strong>Transporte:</strong> Coche recomendable; ferris a Baleares desde el puerto.<br>
        <strong>Fiesta:</strong> Terrazas del puerto y chiringuitos de playa.
      `,
      "Bilbao": `
        <strong>Actividades:</strong> Museo Guggenheim, casco viejo, paseo por la ría, Artxanda y excursiones a la costa vasca.<br>
        <strong>Hoteles:</strong> Zona Guggenheim y centro con hoteles boutique.<br>
        <strong>Transporte:</strong> Metro, tranvía y buses.<br>
        <strong>Fiesta:</strong> Bares de pintxos en el casco viejo y zona de Indautxu.
      `,
      "San Sebastián": `
        <strong>Actividades:</strong> Playa de La Concha, Parte Vieja, Monte Igueldo, Zurriola, ruta de pintxos.<br>
        <strong>Hoteles:</strong> Hoteles frente a la bahía, alojamientos boutique en el centro.<br>
        <strong>Transporte:</strong> Todo se recorre andando o en bici.<br>
        <strong>Fiesta:</strong> Bares de pintxos que se alargan y locales en la Parte Vieja.
      `,
      "Santiago de Compostela": `
        <strong>Actividades:</strong> Catedral, casco histórico, parques como la Alameda, fin del Camino de Santiago.<br>
        <strong>Hoteles:</strong> Hospedajes con encanto en el casco histórico.<br>
        <strong>Transporte:</strong> Ciudad compacta y caminable.<br>
        <strong>Ambiente:</strong> Bares de vino y tapas con mezcla de peregrinos y estudiantes.
      `,
      "A Coruña": `
        <strong>Actividades:</strong> Torre de Hércules, paseo marítimo, playas de Riazor y Orzán.<br>
        <strong>Hoteles:</strong> Hoteles frente al mar y centro urbano.<br>
        <strong>Transporte:</strong> Buses urbanos, ciudad fácil para caminar.<br>
        <strong>Fiesta:</strong> Zonas de vinos y terrazas en el casco viejo.
      `,
      "Vigo (Rías Baixas)": `
        <strong>Actividades:</strong> Casco viejo, puerto, excursiones a las islas Cíes y Rías Baixas.<br>
        <strong>Hoteles:</strong> Hoteles en el centro y alojamientos en la ría.<br>
        <strong>Transporte:</strong> Buen punto para explorar Rías Baixas en coche.<br>
        <strong>Fiesta:</strong> Bares en el casco antiguo y zona del puerto.
      `,
      "Mallorca": `
        <strong>Actividades:</strong> Serra de Tramuntana, Palma, calas como Cala d'Or, Cala Mondragó, pueblos como Sóller o Valldemossa.<br>
        <strong>Hoteles:</strong> Resorts de playa, fincas rurales y hoteles boutique en Palma y Tramuntana.<br>
        <strong>Transporte:</strong> Coche muy recomendable; tren turístico a Sóller.<br>
        <strong>Fiesta:</strong> Beach clubs en Magaluf/Palmanova y bares en Palma.
      `,
      "Ibiza": `
        <strong>Actividades:</strong> Calas como Cala Comte, Cala Bassa o Cala d'Hort, Dalt Vila, atardeceres en San Antonio, excursiones a Formentera.<br>
        <strong>Hoteles:</strong> Hoteles de playa en Playa d'en Bossa y San Antonio, agroturismos y villas en interior.<br>
        <strong>Transporte:</strong> Coche o moto muy recomendables para recorrer la isla.<br>
        <strong>Fiesta:</strong> Clubs y beach clubs como Ushuaïa, Hï Ibiza, Pacha, Amnesia, Hard Rock Hotel, O Beach o UNVRS, además de chiringuitos chill.
      `,
      "Menorca": `
        <strong>Actividades:</strong> Calas vírgenes (Macarella, Turqueta, Mitjana), pueblos como Ciutadella y Mahón, Camí de Cavalls.<br>
        <strong>Hoteles:</strong> Hoteles familiares de playa y alojamientos rurales muy tranquilos.<br>
        <strong>Transporte:</strong> Coche imprescindible para llegar a calas.<br>
        <strong>Ambiente:</strong> Muy relajado, ideal para desconectar.
      `,
      "Formentera": `
        <strong>Actividades:</strong> Playas de Ses Illetes y Migjorn, rutas en bici, faro de La Mola.<br>
        <strong>Hoteles:</strong> Pequeños hoteles y apartamentos cerca del mar.<br>
        <strong>Transporte:</strong> Llegada en barco desde Ibiza; moverse en moto o bici.<br>
        <strong>Ambiente:</strong> Chill y bohemio, con beach bars al atardecer.
      `,
      "Tenerife": `
        <strong>Actividades:</strong> Parque Nacional del Teide, Anaga, playas del sur (Costa Adeje, Los Cristianos).<br>
        <strong>Hoteles:</strong> Resorts en el sur para sol y playa, hoteles rurales en el norte.<br>
        <strong>Transporte:</strong> Coche muy recomendable para recorrer la isla.<br>
        <strong>Fiesta:</strong> Playa de las Américas y Costa Adeje.
      `,
      "Gran Canaria": `
        <strong>Actividades:</strong> Dunas de Maspalomas, Las Palmas, rutas por el interior montañoso.<br>
        <strong>Hoteles:</strong> Resorts en Maspalomas y Playa del Inglés, hoteles urbanos en Las Palmas.<br>
        <strong>Transporte:</strong> Autobuses y coche de alquiler.<br>
        <strong>Fiesta:</strong> Vida nocturna en Playa del Inglés y Las Palmas.
      `,
      "Lanzarote": `
        <strong>Actividades:</strong> Timanfaya, Jameos del Agua, Cueva de los Verdes, viñedos de La Geria.<br>
        <strong>Hoteles:</strong> Costa Teguise, Puerto del Carmen y Playa Blanca.<br>
        <strong>Transporte:</strong> Coche recomendable para ver volcanes y playas.<br>
        <strong>Ambiente:</strong> Restaurantes frente al mar y bares relajados.
      `,
      "Fuerteventura": `
        <strong>Actividades:</strong> Playas de Corralejo y Jandía, surf, kitesurf y windsurf.<br>
        <strong>Hoteles:</strong> Resorts en el norte y sur, alojamientos orientados a deportes de agua.<br>
        <strong>Transporte:</strong> Coche recomendable, distancias largas entre zonas.<br>
        <strong>Ambiente:</strong> Bares de surfistas y chiringuitos frente al mar.
      `
    };

    function getGenericCityInfo(city) {
      return `
        <strong>Actividades:</strong> Paseo por el centro, visitas culturales y naturaleza cercana.<br>
        <strong>Hoteles:</strong> Alojamiento en zona céntrica o en áreas tranquilas según el estilo de viaje.<br>
        <strong>Transporte:</strong> Combinar transporte público y coche de alquiler si quieres moverte por la región.<br>
        <strong>Ambiente:</strong> Bares y restaurantes locales para probar la gastronomía típica.
      `;
    }

    freePlanBtn.addEventListener("click", () => {
      freePlanContainer.innerHTML = "";
      freePlanContainer.classList.remove("hidden");
      personalPlanContainer.classList.add("hidden");

      for (let ccaa in ccaaData) {
        const section = document.createElement("div");
        section.className = "ccaa-section";

        const title = document.createElement("div");
        title.className = "ccaa-title";
        title.innerHTML = `<span>${ccaa}</span><span>+</span>`;

        const list = document.createElement("div");
        list.className = "city-list";

        ccaaData[ccaa].forEach(city => {
          const c = document.createElement("div");
          c.className = "city";
          c.textContent = city;

          c.addEventListener("click", () => {
            // eliminar info anterior de esa CCAA
            list.querySelectorAll(".info-box").forEach(el => el.remove());

            const info = document.createElement("div");
            info.className = "info-box";
            info.innerHTML = cityInfo[city] || getGenericCityInfo(city);
            list.appendChild(info);
          });

          list.appendChild(c);
        });

        title.addEventListener("click", () => {
          const isVisible = list.style.display === "block";
          list.style.display = isVisible ? "none" : "block";
          title.querySelectorAll("span")[1].textContent = isVisible ? "+" : "−";
        });

        section.appendChild(title);
        section.appendChild(list);
        freePlanContainer.appendChild(section);
      }
    });

    // ============================================================
    //   PLAN PERSONALIZADO: CUESTIONARIO PASO A PASO
    // ============================================================

    let step = 0;
    const TOTAL_STEPS = 9; // 0..8
    const answers = {
      nombre: "",
      email: "",
      edad: "",
      destino: "",
      personas: "",
      presupuesto: "",
      fechaIda: "",
      fechaVuelta: "",
      ritmo: "",
      alojamiento: ""
    };

    const destinosSelectOptions = (() => {
      const groups = [];
      groups.push({
        label: "Opción automática",
        options: ["Sitio aleatorio con propuestas según tu perfil"]
      });
      for (let ccaa in ccaaData) {
        groups.push({
          label: ccaa,
          options: ccaaData[ccaa]
        });
      }
      return groups;
    })();

    function renderProgress(container) {
      const wrapper = document.createElement("div");
      wrapper.className = "progress-wrapper";
      const text = document.createElement("div");
      text.textContent = `Pregunta ${step + 1} de ${TOTAL_STEPS}`;
      const barBg = document.createElement("div");
      barBg.className = "progress-bar-bg";
      const barFill = document.createElement("div");
      barFill.className = "progress-bar-fill";
      const percent = ((step + 1) / TOTAL_STEPS) * 100;
      barFill.style.width = percent + "%";
      barBg.appendChild(barFill);
      wrapper.appendChild(text);
      wrapper.appendChild(barBg);
      container.appendChild(wrapper);
    }

    function renderQuestion() {
      personalPlanContainer.innerHTML = "";
      personalPlanContainer.classList.remove("hidden");
      freePlanContainer.classList.add("hidden");

      const box = document.createElement("div");
      box.className = "question-box";

      if (step === 0) {
        box.innerHTML = `
          <h3>1. Nombre completo</h3>
          <label>Escribe tu nombre completo para saber cómo dirigirnos a ti.</label>
          <input type="text" id="nombreInput" placeholder="Nombre y apellidos" value="${answers.nombre || ""}">
        `;
      } else if (step === 1) {
        box.innerHTML = `
          <h3>2. Correo de contacto</h3>
          <label>Escribe tu correo. Ahí recibirás tu propuesta de viaje en PDF.</label>
          <input type="email" id="emailInput" placeholder="tucorreo@ejemplo.com" value="${answers.email || ""}">
        `;
      } else if (step === 2) {
        box.innerHTML = `
          <h3>3. ¿Edad?</h3>
          <label>Elige tu rango de edad.</label>
          <select id="edadSelect">
            <option value="">Selecciona una opción</option>
            <option value="18-26">18-26</option>
            <option value="26-34">26-34</option>
            <option value="34-42">34-42</option>
            <option value="42-50">42-50</option>
            <option value="+50">+50</option>
          </select>
        `;
        if (answers.edad) {
          setTimeout(() => {
            document.getElementById("edadSelect").value = answers.edad;
          }, 0);
        }
      } else if (step === 3) {
        const destWrapper = document.createElement("div");
        destWrapper.innerHTML = `
          <h3>4. ¿Qué deseas visitar?</h3>
          <label>Elige ciudad o zona. También puedes seleccionar un sitio aleatorio.</label>
        `;
        const select = document.createElement("select");
        select.id = "destinoSelect";
        const defaultOpt = document.createElement("option");
        defaultOpt.value = "";
        defaultOpt.textContent = "Selecciona un destino";
        select.appendChild(defaultOpt);

        destinosSelectOptions.forEach(group => {
          const optgroup = document.createElement("optgroup");
          optgroup.label = group.label;
          group.options.forEach(optText => {
            const opt = document.createElement("option");
            opt.value = optText;
            opt.textContent = optText;
            optgroup.appendChild(opt);
          });
          select.appendChild(optgroup);
        });

        destWrapper.appendChild(select);
        box.appendChild(destWrapper);

        if (answers.destino) {
          setTimeout(() => {
            document.getElementById("destinoSelect").value = answers.destino;
          }, 0);
        }
      } else if (step === 4) {
        box.innerHTML = `
          <h3>5. ¿Cuántos viajan?</h3>
          <label>Elige el número total de personas.</label>
          <select id="personasSelect">
            <option value="">Selecciona</option>
            ${Array.from({length: 20}, (_, i) => `<option value="${i+1}">${i+1}</option>`).join("")}
          </select>
        `;
        if (answers.personas) {
          setTimeout(() => {
            document.getElementById("personasSelect").value = answers.personas;
          }, 0);
        }
      } else if (step === 5) {
        box.innerHTML = `
          <h3>6. ¿Cuánto estás dispuesto a pagar (sin contar el vuelo)?</h3>
          <label>Presupuesto aproximado por persona.</label>
          <select id="presupuestoSelect">
            <option value="">Selecciona un rango</option>
            <option value="-300">Hasta 300€</option>
            <option value="300-600">300€ - 600€</option>
            <option value="600-900">600€ - 900€</option>
            <option value="+1000">Más de 1000€</option>
          </select>
        `;
        if (answers.presupuesto) {
          setTimeout(() => {
            document.getElementById("presupuestoSelect").value = answers.presupuesto;
          }, 0);
        }
      } else if (step === 6) {
        box.innerHTML = `
          <h3>7. ¿Cuánto tiempo?</h3>
          <label>Selecciona fechas de ida y vuelta.</label>
          <div class="daterange">
            <div>
              <small>Fecha de ida</small>
              <input type="date" id="fechaIdaInput" value="${answers.fechaIda || ""}">
            </div>
            <div>
              <small>Fecha de vuelta</small>
              <input type="date" id="fechaVueltaInput" value="${answers.fechaVuelta || ""}">
            </div>
          </div>
        `;
      } else if (step === 7) {
        box.innerHTML = `
          <h3>8. ¿Cómo quieres el viaje?</h3>
          <label>Elige el ritmo del viaje.</label>
          <select id="ritmoSelect">
            <option value="">Selecciona</option>
            <option value="Tranquilo">Tranquilo</option>
            <option value="Intenso">Intenso</option>
            <option value="Equilibrado">Equilibrado</option>
            <option value="No me importa">No me importa</option>
          </select>
        `;
        if (answers.ritmo) {
          setTimeout(() => {
            document.getElementById("ritmoSelect").value = answers.ritmo;
          }, 0);
        }
      } else if (step === 8) {
        box.innerHTML = `
          <h3>9. ¿Dónde quieres pasar tu estancia?</h3>
          <label>Tipo de alojamiento preferido.</label>
          <select id="alojamientoSelect">
            <option value="">Selecciona</option>
            <option value="Hotel">Hotel</option>
            <option value="Airbnb">Airbnb</option>
            <option value="Villa">Villa</option>
          </select>
        `;
        if (answers.alojamiento) {
          setTimeout(() => {
            document.getElementById("alojamientoSelect").value = answers.alojamiento;
          }, 0);
        }
      }

      const buttonsDiv = document.createElement("div");

      if (step > 0) {
        const backBtn = document.createElement("button");
        backBtn.textContent = "Volver";
        backBtn.className = "back-btn";
        backBtn.onclick = () => {
          saveCurrentStep();
          step--;
          renderQuestion();
        };
        buttonsDiv.appendChild(backBtn);
      }

      const nextBtn = document.createElement("button");
      nextBtn.className = "next-btn";
      nextBtn.textContent = step === TOTAL_STEPS - 1 ? "Ir a confirmar" : "Siguiente";

      nextBtn.onclick = () => {
        if (!saveCurrentStep(true)) return;

        if (step < TOTAL_STEPS - 1) {
          step++;
          renderQuestion();
        } else {
          renderConditions();
        }
      };

      buttonsDiv.appendChild(nextBtn);
      box.appendChild(buttonsDiv);

      const note = document.createElement("div");
      note.className = "privacy-note";
      note.textContent = "Tus datos solo se usan para preparar tu viaje y no se comparten con terceros.";
      box.appendChild(note);

      personalPlanContainer.appendChild(box);
      renderProgress(personalPlanContainer);
    }

    function saveCurrentStep(showAlerts) {
      if (step === 0) {
        const val = document.getElementById("nombreInput").value.trim();
        if (!val && showAlerts) {
          alert("Por favor, escribe tu nombre completo.");
          return false;
        }
        answers.nombre = val;
      } else if (step === 1) {
        const val = document.getElementById("emailInput").value.trim();
        if (!val && showAlerts) {
          alert("Por favor, escribe tu correo de contacto.");
          return false;
        }
        answers.email = val;
      } else if (step === 2) {
        const val = document.getElementById("edadSelect").value;
        if (!val && showAlerts) {
          alert("Por favor, elige un rango de edad.");
          return false;
        }
        answers.edad = val;
      } else if (step === 3) {
        const val = document.getElementById("destinoSelect").value;
        if (!val && showAlerts) {
          alert("Por favor, elige un destino o la opción aleatoria.");
          return false;
        }
        answers.destino = val;
      } else if (step === 4) {
        const val = document.getElementById("personasSelect").value;
        if (!val && showAlerts) {
          alert("Por favor, indica cuántos viajan.");
          return false;
        }
        answers.personas = val;
      } else if (step === 5) {
        const val = document.getElementById("presupuestoSelect").value;
        if (!val && showAlerts) {
          alert("Por favor, indica tu presupuesto aproximado.");
          return false;
        }
        answers.presupuesto = val;
      } else if (step === 6) {
        const ida = document.getElementById("fechaIdaInput").value;
        const vuelta = document.getElementById("fechaVueltaInput").value;
        if ((!ida || !vuelta) && showAlerts) {
          alert("Por favor, selecciona fechas de ida y vuelta.");
          return false;
        }
        answers.fechaIda = ida;
        answers.fechaVuelta = vuelta;
      } else if (step === 7) {
        const val = document.getElementById("ritmoSelect").value;
        if (!val && showAlerts) {
          alert("Por favor, indica cómo quieres el viaje.");
          return false;
        }
        answers.ritmo = val;
      } else if (step === 8) {
        const val = document.getElementById("alojamientoSelect").value;
        if (!val && showAlerts) {
          alert("Por favor, elige el tipo de alojamiento.");
          return false;
        }
        answers.alojamiento = val;
      }

      return true;
    }

    function renderConditions() {
      personalPlanContainer.innerHTML = "";
      const box = document.createElement("div");
      box.className = "conditions-box";

      const resumen = `
        <p><strong>Resumen de tu viaje:</strong></p>
        <ul>
          <li><strong>Nombre:</strong> ${answers.nombre}</li>
          <li><strong>Correo:</strong> ${answers.email}</li>
          <li><strong>Edad:</strong> ${answers.edad}</li>
          <li><strong>Destino:</strong> ${answers.destino}</li>
          <li><strong>Personas:</strong> ${answers.personas}</li>
          <li><strong>Presupuesto aprox. por persona:</strong> ${answers.presupuesto}</li>
          <li><strong>Fechas:</strong> ${answers.fechaIda} → ${answers.fechaVuelta}</li>
          <li><strong>Ritmo:</strong> ${answers.ritmo}</li>
          <li><strong>Alojamiento preferido:</strong> ${answers.alojamiento}</li>
        </ul>
      `;

      box.innerHTML = `
        <h3>Condiciones y envío del plan</h3>
        ${resumen}
        <p>Antes de finalizar, revisa estas condiciones:</p>
        <ul>
          <li>Tu viaje se generará de forma personalizada combinando IA y revisión humana.</li>
          <li>Recibirás la propuesta en un máximo de <strong>24 horas</strong> al correo indicado.</li>
          <li>Podrás responder a ese correo para solicitar ajustes o cambios.</li>
        </ul>
        <div class="conditions-actions">
          <input type="checkbox" id="condicionesCheck">
          <label for="condicionesCheck">Acepto estas condiciones y deseo recibir mi viaje en menos de 24h.</label>
        </div>
      `;

      const buttonsDiv = document.createElement("div");
      buttonsDiv.style.marginTop = "15px";

      const backBtn = document.createElement("button");
      backBtn.textContent = "Volver y editar";
      backBtn.className = "back-btn";
      backBtn.onclick = () => {
        step = 0;
        renderQuestion();
      };

      const finishBtn = document.createElement("button");
      finishBtn.textContent = "Finalizar y enviar";
      finishBtn.className = "next-btn";
      finishBtn.onclick = () => {
        const check = document.getElementById("condicionesCheck").checked;
        if (!check) {
          alert("Debes aceptar las condiciones para continuar.");
          return;
        }
        sendEmailAndPdf();
      };

      buttonsDiv.appendChild(backBtn);
      buttonsDiv.appendChild(finishBtn);
      box.appendChild(buttonsDiv);

      personalPlanContainer.appendChild(box);
    }

    function buildBodyText() {
      return [
        "Nuevo cuestionario de viaje desde la web Explorando España:",
        "",
        `Nombre completo: ${answers.nombre}`,
        `Correo de contacto: ${answers.email}`,
        `Edad: ${answers.edad}`,
        `Destino deseado: ${answers.destino}`,
        `Número de viajeros: ${answers.personas}`,
        `Presupuesto aprox. por persona (sin vuelo): ${answers.presupuesto}`,
        `Fecha de ida: ${answers.fechaIda}`,
        `Fecha de vuelta: ${answers.fechaVuelta}`,
        `Ritmo de viaje: ${answers.ritmo}`,
        `Tipo de alojamiento: ${answers.alojamiento}`,
        "",
        "Generar propuesta de viaje en menos de 24h."
      ].join("\n");
    }

    function sendEmailAndPdf() {
      const bodyText = buildBodyText();
      const subject = "Nuevo cuestionario de viaje - Explorando España";

      const mailtoLink =
        "mailto:" + encodeURIComponent(DESTINO_EMAIL) +
        "?subject=" + encodeURIComponent(subject) +
        "&body=" + encodeURIComponent(bodyText);

      window.location.href = mailtoLink;

      if (window.jspdf) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        let y = 10;
        const lines = bodyText.split("\n");
        doc.setFontSize(12);
        lines.forEach(line => {
          doc.text(line, 10, y);
          y += 7;
          if (y > 280) {
            doc.addPage();
            y = 10;
          }
        });
        doc.save("cuestionario-viaje.pdf");
      }

      personalPlanContainer.innerHTML = `
        <div id="confirmationMessage">
          <strong>¡Cuestionario enviado!</strong>
          <p>En menos de 24 horas recibirás tu propuesta de viaje personalizada en el correo <strong>${answers.email}</strong>.</p>
          <p>Si no te llega nada, puedes escribir a <strong>${DESTINO_EMAIL}</strong> indicando tu nombre y la fecha en la que rellenaste el formulario.</p>
        </div>
      `;
    }

    personalPlanBtn.addEventListener("click", () => {
      step = 0;
      renderQuestion();
    });
  </script>
</body>
</html>
