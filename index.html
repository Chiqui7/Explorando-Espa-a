<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Explorando España</title>

  <!-- Librería para generar PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    :root {
      --bg: #FDF5E6;          /* arena suave */
      --text: #1C3D5A;        /* azul mar */
      --accent: #77C9D4;      /* turquesa */
      --accent-dark: #57A99A; /* verde palmera */
      --success: #D4FFD8;     /* verde suave éxito */
      --card: #FFFFFF;
      --shadow: 0 2px 6px rgba(0,0,0,0.06);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      text-align: center;
    }

    h1 {
      margin-top: 20px;
      margin-bottom: 10px;
    }

    p.subtitle {
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 14px;
      opacity: 0.8;
    }

    button {
      padding: 14px 26px;
      margin: 10px;
      font-size: 18px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }

    #freePlanBtn {
      background: #E9DAC4;
      color: var(--text);
    }

    #personalPlanBtn {
      background: var(--accent);
      color: #ffffff;
    }

    .container {
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
    }

    .hidden {
      display: none;
    }

    /* PLAN GRATUITO */

    .ccaa-section {
      text-align: left;
      background: var(--card);
      padding: 15px;
      margin-top: 10px;
      border-radius: 8px;
      box-shadow: var(--shadow);
    }

    .ccaa-title {
      cursor: pointer;
      font-weight: bold;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .ccaa-title span {
      font-size: 18px;
    }

    .city-list {
      display: none;
      margin-left: 8px;
      margin-top: 8px;
    }

    .city {
      cursor: pointer;
      margin: 4px 0;
      color: var(--accent-dark);
      text-decoration: underline;
      text-decoration-style: dotted;
      font-size: 14px;
    }

    .info-box {
      margin-top: 10px;
      padding: 10px;
      background: #E5F7FA;
      border-radius: 6px;
      font-size: 13px;
    }

    /* PLAN PERSONALIZADO */

    .question-box {
      background: var(--card);
      padding: 20px;
      border-radius: 10px;
      margin-top: 30px;
      text-align: left;
      box-shadow: var(--shadow);
    }

    .question-box h3 {
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 18px;
    }

    .question-box label {
      font-size: 14px;
      display: block;
      margin-bottom: 5px;
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 4px;
      margin-bottom: 20px;
      border-radius: 6px;
      border: 1px solid #aaa;
      font-size: 14px;
    }

    .daterange {
      display: flex;
      gap: 10px;
    }

    .daterange div {
      flex: 1;
    }

    .back-btn {
      background: var(--text);
      color: white;
      margin-right: 10px;
      font-size: 16px;
    }

    .next-btn {
      background: var(--accent);
      color: white;
      font-size: 16px;
    }

    .conditions-box {
      background: var(--card);
      padding: 20px;
      border-radius: 10px;
      margin-top: 30px;
      text-align: left;
      box-shadow: var(--shadow);
      font-size: 14px;
    }

    .conditions-box ul {
      padding-left: 20px;
    }

    .conditions-box li {
      margin-bottom: 6px;
    }

    .conditions-actions {
      margin-top: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .conditions-actions input[type="checkbox"] {
      width: auto;
      margin: 0;
    }

    .conditions-actions label {
      margin: 0;
    }

    #confirmationMessage {
      margin-top: 20px;
      background: var(--success);
      padding: 20px;
      border-radius: 10px;
      font-size: 14px;
      text-align: left;
    }

    #confirmationMessage strong {
      display: block;
      margin-bottom: 6px;
    }

    iframe {
      width: 100%;
      height: 400px;
      border: 0;
      margin-top: 30px;
      border-radius: 10px;
    }

    @media (max-width: 600px) {
      .container {
        padding: 10px;
      }

      button {
        width: 90%;
        max-width: 320px;
      }

      .daterange {
        flex-direction: column;
      }
    }
  </style>
</head>

<body>

  <h1>Explorando España</h1>
  <p class="subtitle">Elige un plan para inspirarte o para crear tu viaje perfecto en menos de 24 horas.</p>

  <!-- BOTONES PRINCIPALES -->
  <button id="freePlanBtn">PLAN GRATUITO</button>
  <button id="personalPlanBtn">PLAN PERSONALIZADO</button>

  <!-- CONTENEDORES DE CADA PLAN -->
  <div id="freePlan" class="container hidden"></div>
  <div id="personalPlan" class="container hidden"></div>

  <!-- MAPA DE ESPAÑA, SIEMPRE ABAJO -->
  <iframe
    loading="lazy"
    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d4889502.373868815!2d-9.556876061667067!3d40.20847784486433!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0xd6b61b4f20bb6c3%3A0x10340f3c9caa480!2sEspaña!5e0!3m2!1ses!2ses!4v1700000000000">
  </iframe>

  <script>
    const DESTINO_EMAIL = "contacto.adriangilj@gmail.com";

    const freePlanBtn = document.getElementById("freePlanBtn");
    const personalPlanBtn = document.getElementById("personalPlanBtn");
    const freePlanContainer = document.getElementById("freePlan");
    const personalPlanContainer = document.getElementById("personalPlan");

    // ============================================================
    //   PLAN GRATUITO: CCAA + CIUDADES + INFO
    // ============================================================

    const ccaaData = {
      "Andalucía": [
        "Sevilla",
        "Málaga",
        "Cádiz",
        "Granada",
        "Córdoba",
        "Almería",
        "Huelva",
        "Jaén"
      ],
      "Cataluña": [
        "Barcelona",
        "Girona (Costa Brava)",
        "Tarragona (Costa Dorada)",
        "Lleida (Pirineo)"
      ],
      "Comunidad de Madrid": [
        "Madrid",
        "Sierra de Guadarrama"
      ],
      "Comunidad Valenciana": [
        "Valencia",
        "Alicante (Costa Blanca)",
        "Castellón",
        "Dénia"
      ],
      "País Vasco": [
        "Bilbao",
        "San Sebastián",
        "Vitoria-Gasteiz",
        "Costa vasca"
      ],
      "Galicia": [
        "Santiago de Compostela",
        "A Coruña",
        "Vigo (Rías Baixas)",
        "Lugo",
        "Ourense"
      ],
      "Islas Baleares": [
        "Mallorca",
        "Ibiza",
        "Menorca",
        "Formentera"
      ],
      "Islas Canarias": [
        "Tenerife",
        "Gran Canaria",
        "Lanzarote",
        "Fuerteventura",
        "La Palma"
      ],
      "Murcia": [
        "Murcia",
        "Cartagena",
        "La Manga"
      ],
      "Navarra": [
        "Pamplona",
        "Pirineo navarro"
      ],
      "Aragón": [
        "Zaragoza",
        "Huesca (Pirineo)",
        "Teruel"
      ],
      "Castilla y León": [
        "Salamanca",
        "Segovia",
        "Ávila",
        "León",
        "Burgos",
        "Valladolid"
      ],
      "Castilla-La Mancha": [
        "Toledo",
        "Cuenca",
        "Albacete",
        "Ciudad Real",
        "Guadalajara"
      ],
      "Asturias": [
        "Oviedo",
        "Gijón",
        "Cudillero",
        "Ribadesella"
      ],
      "Cantabria": [
        "Santander",
        "Picos de Europa (zona cántabra)"
      ],
      "La Rioja": [
        "Logroño",
        "Ruta del vino en La Rioja"
      ],
      "Extremadura": [
        "Cáceres",
        "Mérida",
        "Badajoz"
      ],
      "Ceuta y Melilla": [
        "Ceuta",
        "Melilla"
      ]
    };

    // Información más detallada con sitios concretos
    const cityInfo = {
      "Sevilla": `
        <strong>Actividades:</strong> Catedral y Giralda, Real Alcázar, Plaza de España, paseo por el Barrio de Santa Cruz y orillas del río Guadalquivir.<br>
        <strong>Hoteles:</strong> Hoteles boutique cerca de la Catedral, alojamientos con terraza en Triana y zona centro.<br>
        <strong>Transporte:</strong> AVE con Madrid y Barcelona, tranvía y buses; el casco histórico se recorre a pie.<br>
        <strong>Fiesta:</strong> Triana (Betis y Pureza), Alameda de Hércules, terrazas de la zona de la Cartuja y tablaos flamencos.
      `,
      "Málaga": `
        <strong>Actividades:</strong> Alcazaba y castillo de Gibralfaro, Muelle Uno, Museo Picasso, Centre Pompidou, playas de la Malagueta y Pedregalejo.<br>
        <strong>Hoteles:</strong> Hoteles de ciudad en el centro histórico, hoteles con rooftop en Soho y resorts de playa en la Costa del Sol.<br>
        <strong>Transporte:</strong> Aeropuerto muy bien conectado, tren de cercanías a la costa, autobuses urbanos.<br>
        <strong>Fiesta:</strong> Bares de Soho y centro, chiringuitos con música en la playa y zona de Teatinos para ambiente local.
      `,
      "Cádiz": `
        <strong>Actividades:</strong> Casco histórico, playa de La Caleta, castillo de San Sebastián, excursiones a Tarifa, Zahara de los Atunes o Conil.<br>
        <strong>Hoteles:</strong> Hoteles pequeños en el casco antiguo, alojamientos frente al mar y resorts en la costa.<br>
        <strong>Transporte:</strong> Tren desde Sevilla, coche ideal para recorrer la Costa de la Luz.<br>
        <strong>Fiesta:</strong> Terrazas del casco antiguo y bares junto al paseo marítimo.
      `,
      "Granada": `
        <strong>Actividades:</strong> Alhambra, Albaicín, Sacromonte, mirador de San Nicolás y ruta de tapas por el centro.<br>
        <strong>Hoteles:</strong> Zona Catedral, Realejo y hoteles con vistas a la Alhambra.<br>
        <strong>Transporte:</strong> Ciudad muy caminable; buses urbanos y acceso a Sierra Nevada en temporada.<br>
        <strong>Fiesta:</strong> Bares de tapas en Calle Elvira y Navas, pubs en Pedro Antonio y ambiente universitario.
      `,
      "Córdoba": `
        <strong>Actividades:</strong> Mezquita-Catedral, Judería, patios cordobeses, Medina Azahara.<br>
        <strong>Hoteles:</strong> Alojamiento en la Judería, hoteles con patio interior y casas tradicionales.<br>
        <strong>Transporte:</strong> AVE con Madrid y Sevilla, casi todo se puede hacer andando.<br>
        <strong>Fiesta:</strong> Terrazas junto al río y zona centro con bares íntimos.
      `,
      "Barcelona": `
        <strong>Actividades:</strong> Sagrada Familia, Park Güell, Casa Batlló, paseo por el Born y el Gòtic, playas de la Barceloneta y Port Olímpic.<br>
        <strong>Hoteles:</strong> Eixample para moverse bien, hoteles frente al mar en Barceloneta y Vila Olímpica.<br>
        <strong>Transporte:</strong> Metro y buses muy completos, fácil moverse sin coche.<br>
        <strong>Fiesta:</strong> Tapas y copas en El Born y Poble-sec, clubs y beach clubs en Port Olímpic y salas como Razzmatazz.
      `,
      "Girona (Costa Brava)": `
        <strong>Actividades:</strong> Casco medieval de Girona, pueblos como Tossa de Mar, Calella de Palafrugell, Begur o Cadaqués, calas de agua turquesa.<br>
        <strong>Hoteles:</strong> Hoteles en Girona ciudad, casas rurales en el interior y alojamientos junto al mar en la Costa Brava.<br>
        <strong>Transporte:</strong> Tren a Girona; coche muy recomendable para moverse entre calas y pueblos.<br>
        <strong>Fiesta:</strong> Chiringuitos y terrazas en la costa, bares tranquilos de pueblo.
      `,
      "Madrid": `
        <strong>Actividades:</strong> Museo del Prado, Reina Sofía y Thyssen, Parque del Retiro, Palacio Real, barrios como Malasaña, Chueca y La Latina.<br>
        <strong>Hoteles:</strong> Zona Gran Vía, Sol y Huertas para estar en el corazón de la ciudad; Chamberí para algo más tranquilo.<br>
        <strong>Transporte:</strong> Metro y cercanías cubren prácticamente todo, no necesitas coche.<br>
        <strong>Fiesta:</strong> Malasaña y Chueca para ambiente alternativo y LGTBI, Huertas y La Latina para tapas y copas, azoteas en Gran Vía.
      `,
      "Valencia": `
        <strong>Actividades:</strong> Ciudad de las Artes y las Ciencias, casco histórico, parque del Turia, playas de la Malvarrosa y Patacona, paella en la Albufera.<br>
        <strong>Hoteles:</strong> Centro para combinar cultura y ocio, alojamientos frente al mar en la zona de playa.<br>
        <strong>Transporte:</strong> Metro y tranvía, ciudad muy amigable para la bici.<br>
        <strong>Fiesta:</strong> Bares y pubs en Ruzafa y Cánovas, locales junto al mar en Marina y paseo marítimo.
      `,
      "Alicante (Costa Blanca)": `
        <strong>Actividades:</strong> Castillo de Santa Bárbara, paseo por el casco antiguo y Explanada, excursiones a la Costa Blanca (Altea, Calpe, Benidorm).<br>
        <strong>Hoteles:</strong> Hoteles y apartamentos frente al mar, alojamientos en el centro histórico y zona de puerto.<br>
        <strong>Transporte:</strong> Aeropuerto cercano, tranvía TRAM por la costa y buen acceso en tren.<br>
        <strong>Fiesta:</strong> Bares y discotecas junto al puerto y paseo marítimo, beach clubs en la Costa Blanca.
      `,
      "Dénia": `
        <strong>Actividades:</strong> Playas de Les Marines y Les Rotes, castillo de Dénia, rutas por el Montgó, paseos en barco hacia Ibiza y Formentera.<br>
        <strong>Hoteles:</strong> Hoteles y apartamentos frente al mar, casas rurales en la zona interior.<br>
        <strong>Transporte:</strong> Coche muy recomendable; ferris desde el puerto hacia Baleares.<br>
        <strong>Fiesta:</strong> Terrazas del puerto, chiringuitos de playa y locales con música en verano.
      `,
      "Bilbao": `
        <strong>Actividades:</strong> Museo Guggenheim, casco viejo (Siete Calles), paseo por la ría, funicular de Artxanda, excursiones a San Juan de Gaztelugatxe.<br>
        <strong>Hoteles:</strong> Zona Guggenheim y centro, hoteles boutique cerca de la ría.<br>
        <strong>Transporte:</strong> Metro, tranvía y buses, buena base para visitar la costa vasca.<br>
        <strong>Fiesta:</strong> Bares de pintxos en el casco viejo y zonas de Indautxu y Pozas.
      `,
      "San Sebastián": `
        <strong>Actividades:</strong> Playa de La Concha, Parte Vieja, monte Igueldo, Ondarreta y Zurriola, ruta de pintxos.<br>
        <strong>Hoteles:</strong> Hoteles frente a La Concha, alojamientos boutique en la Parte Vieja.<br>
        <strong>Transporte:</strong> Ciudad perfecta para caminar o ir en bici; trenes regionales a pueblos cercanos.<br>
        <strong>Fiesta:</strong> Bares de pintxos que se alargan hasta la noche y locales de copas en la Parte Vieja.
      `,
      "Santiago de Compostela": `
        <strong>Actividades:</strong> Catedral y plaza del Obradoiro, casco histórico, parques como la Alameda, fin de etapa del Camino de Santiago.<br>
        <strong>Hoteles:</strong> Hospedajes con encanto en el centro histórico y hoteles modernos en el ensanche.<br>
        <strong>Transporte:</strong> Tren con A Coruña y resto de Galicia, ciudad muy cómoda para recorrer a pie.<br>
        <strong>Ambiente:</strong> Bares de vinos y tapas con ambiente peregrino y universitario.
      `,
      "A Coruña": `
        <strong>Actividades:</strong> Torre de Hércules, paseo marítimo, casco antiguo, playas de Riazor y Orzán.<br>
        <strong>Hoteles:</strong> Hoteles frente al mar y alojamientos en el centro urbano.<br>
        <strong>Transporte:</strong> Ciudad compacta para ir andando o en bus urbano.<br>
        <strong>Fiesta:</strong> Zonas de vinos y tapas en el Orzán y el casco viejo.
      `,
      "Vigo (Rías Baixas)": `
        <strong>Actividades:</strong> Casco viejo, puerto, excursiones a las islas Cíes, rutas por las Rías Baixas.<br>
        <strong>Hoteles:</strong> Hoteles en el centro y alojamientos de costa en la ría.<br>
        <strong>Transporte:</strong> Buen punto de partida para explorar las Rías Baixas en coche.<br>
        <strong>Fiesta:</strong> Bares del casco histórico y zona del puerto.
      `,
      "Mallorca": `
        <strong>Actividades:</strong> Serra de Tramuntana, Palma histórica, calas como Cala d'Or o Cala Mondragó, pueblos como Sóller o Valldemossa.<br>
        <strong>Hoteles:</strong> Resorts de playa en Palmanova o Alcúdia, fincas rurales y hoteles boutique en Palma y la Tramuntana.<br>
        <strong>Transporte:</strong> Coche muy recomendable para recorrer la isla; tren turístico a Sóller desde Palma.<br>
        <strong>Fiesta:</strong> Beach clubs en zonas como Magaluf o Playa de Palma, bares en el centro de Palma y terrazas con vistas al mar.
      `,
      "Ibiza": `
        <strong>Actividades:</strong> Calas como Cala Comte, Cala Bassa o Cala d'Hort, atardeceres en San Antonio, Dalt Vila (Ibiza ciudad), excursiones en barco a Formentera.<br>
        <strong>Hoteles:</strong> Hoteles de playa y beach clubs en Playa d'en Bossa y San Antonio, agroturismos y villas en el interior para un ambiente más tranquilo.<br>
        <strong>Transporte:</strong> Coche o moto muy recomendables para moverte entre calas, playas y pueblos.<br>
        <strong>Fiesta:</strong> Clubs y beach clubs como Ushuaïa, Hï Ibiza, Pacha, Amnesia, Hard Rock Hotel, O Beach o UNVRS, además de chiringuitos con ambiente chill.
      `,
      "Menorca": `
        <strong>Actividades:</strong> Calas vírgenes como Macarella o Turqueta, pueblos como Ciutadella y Mahón, rutas del Camí de Cavalls.<br>
        <strong>Hoteles:</strong> Hoteles familiares de playa y alojamientos rurales muy tranquilos.<br>
        <strong>Transporte:</strong> Coche imprescindible para llegar a calas y rincones menos conocidos.<br>
        <strong>Ambiente:</strong> Mucho más relajado que Ibiza o Mallorca, ideal para desconectar.
      `,
      "Formentera": `
        <strong>Actividades:</strong> Playas de Ses Illetes y Migjorn, rutas en bici, atardeceres desde el faro de La Mola.<br>
        <strong>Hoteles:</strong> Pequeños hoteles y apartamentos; muchas estancias cerca del mar.<br>
        <strong>Transporte:</strong> Se llega en barco desde Ibiza; moverse en moto o bici es lo más habitual.<br>
        <strong>Ambiente:</strong> Chill, bohemio y muy de día; algunos beach bars con música al atardecer.
      `,
      "Tenerife": `
        <strong>Actividades:</strong> Parque Nacional del Teide, playas del sur (Costa Adeje, Los Cristianos), Anaga, avistamiento de cetáceos en barco.<br>
        <strong>Hoteles:</strong> Resorts en el sur para sol y playa, hoteles rurales en el norte para naturaleza.<br>
        <strong>Transporte:</strong> Coche muy recomendable para recorrer la isla completa.<br>
        <strong>Fiesta:</strong> Zonas de ocio en Playa de las Américas y Costa Adeje.
      `,
      "Gran Canaria": `
        <strong>Actividades:</strong> Dunas de Maspalomas, playas del sur, ciudad de Las Palmas, rutas por el interior montañoso.<br>
        <strong>Hoteles:</strong> Resorts en Maspalomas y Playa del Inglés, hoteles urbanos en Las Palmas.<br>
        <strong>Transporte:</strong> Autobuses interurbanos y coche de alquiler para llegar a las playas más alejadas.<br>
        <strong>Fiesta:</strong> Vida nocturna en Playa del Inglés y Las Palmas.
      `,
      "Lanzarote": `
        <strong>Actividades:</strong> Parque Nacional de Timanfaya, Jameos del Agua, Cueva de los Verdes, viñedos de La Geria.<br>
        <strong>Hoteles:</strong> Zonas de Costa Teguise, Puerto del Carmen y Playa Blanca.<br>
        <strong>Transporte:</strong> Coche para desplazarse entre volcanes, playas y pueblos blancos.<br>
        <strong>Ambiente:</strong> Bares y restaurantes junto al mar con ambiente relajado.
      `,
      "Fuerteventura": `
        <strong>Actividades:</strong> Playas kilométricas como Corralejo y Jandía, deportes acuáticos (surf, kitesurf, windsurf).<br>
        <strong>Hoteles:</strong> Resorts en el norte y sur de la isla, hoteles enfocadas a deportes de agua.<br>
        <strong>Transporte:</strong> Coche muy recomendable; distancias largas entre zonas.<br>
        <strong>Ambiente:</strong> Bares de surfistas y chiringuitos con música frente al mar.
      `
      // El resto usará texto genérico
    };

    function getGenericCityInfo(city) {
      return `
        <strong>Actividades:</strong> Paseo por el centro, visitas culturales y naturaleza de los alrededores.<br>
        <strong>Hoteles:</strong> Alojamiento en zona céntrica o en áreas tranquilas según el estilo de viaje.<br>
        <strong>Transporte:</strong> Recomendable combinar transporte público y coche de alquiler si quieres moverte por la región.<br>
        <strong>Ambiente:</strong> Bares y restaurantes locales para probar la gastronomía típica.
      `;
    }

    freePlanBtn.addEventListener("click", () => {
      freePlanContainer.innerHTML = "";
      freePlanContainer.classList.remove("hidden");
      personalPlanContainer.classList.add("hidden");

      for (let ccaa in ccaaData) {
        const section = document.createElement("div");
        section.className = "ccaa-section";

        const title = document.createElement("div");
        title.className = "ccaa-title";
        title.innerHTML = `<span>${ccaa}</span><span>+</span>`;

        const list = document.createElement("div");
        list.className = "city-list";

        ccaaData[ccaa].forEach(city => {
          const c = document.createElement("div");
          c.className = "city";
          c.textContent = city;

          c.addEventListener("click", () => {
            // BORRAR infos anteriores de esa CCAA antes de mostrar la nueva
            list.querySelectorAll(".info-box").forEach(el => el.remove());

            const info = document.createElement("div");
            info.className = "info-box";
            info.innerHTML = cityInfo[city] || getGenericCityInfo(city);
            list.appendChild(info);
          });

          list.appendChild(c);
        });

        title.addEventListener("click", () => {
          const isVisible = list.style.display === "block";
          list.style.display = isVisible ? "none" : "block";
          title.querySelectorAll("span")[1].textContent = isVisible ? "+" : "−";
        });

        section.appendChild(title);
        section.appendChild(list);
        freePlanContainer.appendChild(section);
      }
    });

    // ============================================================
    //   PLAN PERSONALIZADO: CUESTIONARIO PASO A PASO
    // ============================================================

    let step = 0;
    const answers = {
      nombre: "",
      email: "",
      edad: "",
      destino: "",
      personas: "",
      fechaIda: "",
      fechaVuelta: "",
      ritmo: "",
      alojamiento: ""
    };

    const destinosSelectOptions = (() => {
      const groups = [];
      groups.push({
        label: "Opción automática",
        options: ["Sitio aleatorio con propuestas según tu perfil"]
      });
      for (let ccaa in ccaaData) {
        groups.push({
          label: ccaa,
          options: ccaaData[ccaa]
        });
      }
      return groups;
    })();

    function renderQuestion() {
      personalPlanContainer.innerHTML = "";
      personalPlanContainer.classList.remove("hidden");
      freePlanContainer.classList.add("hidden");

      const box = document.createElement("div");
      box.className = "question-box";

      if (step === 0) {
        box.innerHTML = `
          <h3>1. Nombre completo</h3>
          <label>Escribe tu nombre completo para saber cómo dirigirnos a ti.</label>
          <input type="text" id="nombreInput" placeholder="Nombre y apellidos" value="${answers.nombre || ""}">
        `;
      }

      if (step === 1) {
        box.innerHTML = `
          <h3>2. Correo de contacto</h3>
          <label>Escribe tu correo. Ahí recibirás tu propuesta de viaje en PDF.</label>
          <input type="email" id="emailInput" placeholder="tucorreo@ejemplo.com" value="${answers.email || ""}">
        `;
      }

      if (step === 2) {
        box.innerHTML = `
          <h3>3. ¿Edad?</h3>
          <label>Elige tu rango de edad.</label>
          <select id="edadSelect">
            <option value="">Selecciona una opción</option>
            <option value="18-26">18-26</option>
            <option value="26-34">26-34</option>
            <option value="34-42">34-42</option>
            <option value="42-50">42-50</option>
            <option value="+50">+50</option>
          </select>
        `;
        if (answers.edad) {
          setTimeout(() => {
            document.getElementById("edadSelect").value = answers.edad;
          }, 0);
        }
      }

      if (step === 3) {
        const destWrapper = document.createElement("div");
        destWrapper.innerHTML = `
          <h3>4. ¿Qué deseas visitar?</h3>
          <label>Elige ciudad o zona. También puedes seleccionar un sitio aleatorio.</label>
        `;
        const select = document.createElement("select");
        select.id = "destinoSelect";
        const defaultOpt = document.createElement("option");
        defaultOpt.value = "";
        defaultOpt.textContent = "Selecciona un destino";
        select.appendChild(defaultOpt);

        destinosSelectOptions.forEach(group => {
          const optgroup = document.createElement("optgroup");
          optgroup.label = group.label;
          group.options.forEach(optText => {
            const opt = document.createElement("option");
            opt.value = optText;
            opt.textContent = optText;
            optgroup.appendChild(opt);
          });
          select.appendChild(optgroup);
        });

        destWrapper.appendChild(select);
        box.appendChild(destWrapper);

        if (answers.destino) {
          setTimeout(() => {
            document.getElementById("destinoSelect").value = answers.destino;
          }, 0);
        }
      }

      if (step === 4) {
        box.innerHTML = `
          <h3>5. ¿Cuántos viajan?</h3>
          <label>Elige el número total de personas.</label>
          <select id="personasSelect">
            <option value="">Selecciona</option>
            ${Array.from({length: 20}, (_, i) => `<option value="${i+1}">${i+1}</option>`).join("")}
          </select>
        `;
        if (answers.personas) {
          setTimeout(() => {
            document.getElementById("personasSelect").value = answers.personas;
          }, 0);
        }
      }

      if (step === 5) {
        box.innerHTML = `
          <h3>6. ¿Cuánto tiempo?</h3>
          <label>Selecciona fechas de ida y vuelta.</label>
          <div class="daterange">
            <div>
              <small>Fecha de ida</small>
              <input type="date" id="fechaIdaInput" value="${answers.fechaIda || ""}">
            </div>
            <div>
              <small>Fecha de vuelta</small>
              <input type="date" id="fechaVueltaInput" value="${answers.fechaVuelta || ""}">
            </div>
          </div>
        `;
      }

      if (step === 6) {
        box.innerHTML = `
          <h3>7. ¿Cómo quieres el viaje?</h3>
          <label>Elige el ritmo del viaje.</label>
          <select id="ritmoSelect">
            <option value="">Selecciona</option>
            <option value="Tranquilo">Tranquilo</option>
            <option value="Intenso">Intenso</option>
            <option value="Equilibrado">Equilibrado</option>
            <option value="No me importa">No me importa</option>
          </select>
        `;
        if (answers.ritmo) {
          setTimeout(() => {
            document.getElementById("ritmoSelect").value = answers.ritmo;
          }, 0);
        }
      }

      if (step === 7) {
        box.innerHTML = `
          <h3>8. ¿Dónde quieres pasar tu estancia?</h3>
          <label>Tipo de alojamiento preferido.</label>
          <select id="alojamientoSelect">
            <option value="">Selecciona</option>
            <option value="Hotel">Hotel</option>
            <option value="Airbnb">Airbnb</option>
            <option value="Villa">Villa</option>
          </select>
        `;
        if (answers.alojamiento) {
          setTimeout(() => {
            document.getElementById("alojamientoSelect").value = answers.alojamiento;
          }, 0);
        }
      }

      const buttonsDiv = document.createElement("div");

      if (step > 0) {
        const backBtn = document.createElement("button");
        backBtn.textContent = "Volver";
        backBtn.className = "back-btn";
        backBtn.onclick = () => {
          saveCurrentStep();
          step--;
          renderQuestion();
        };
        buttonsDiv.appendChild(backBtn);
      }

      const nextBtn = document.createElement("button");
      nextBtn.className = "next-btn";
      nextBtn.textContent = step === 7 ? "Ir a confirmar" : "Siguiente";

      nextBtn.onclick = () => {
        if (!saveCurrentStep(true)) return;

        if (step < 7) {
          step++;
          renderQuestion();
        } else {
          renderConditions();
        }
      };

      buttonsDiv.appendChild(nextBtn);
      box.appendChild(buttonsDiv);

      personalPlanContainer.appendChild(box);
    }

    function saveCurrentStep(showAlerts) {
      if (step === 0) {
        const val = document.getElementById("nombreInput").value.trim();
        if (!val && showAlerts) {
          alert("Por favor, escribe tu nombre completo.");
          return false;
        }
        answers.nombre = val;
      }

      if (step === 1) {
        const val = document.getElementById("emailInput").value.trim();
        if (!val && showAlerts) {
          alert("Por favor, escribe tu correo de contacto.");
          return false;
        }
        answers.email = val;
      }

      if (step === 2) {
        const val = document.getElementById("edadSelect").value;
        if (!val && showAlerts) {
          alert("Por favor, elige un rango de edad.");
          return false;
        }
        answers.edad = val;
      }

      if (step === 3) {
        const val = document.getElementById("destinoSelect").value;
        if (!val && showAlerts) {
          alert("Por favor, elige un destino o la opción aleatoria.");
          return false;
        }
        answers.destino = val;
      }

      if (step === 4) {
        const val = document.getElementById("personasSelect").value;
        if (!val && showAlerts) {
          alert("Por favor, indica cuántos viajan.");
          return false;
        }
        answers.personas = val;
      }

      if (step === 5) {
        const ida = document.getElementById("fechaIdaInput").value;
        const vuelta = document.getElementById("fechaVueltaInput").value;
        if ((!ida || !vuelta) && showAlerts) {
          alert("Por favor, selecciona fechas de ida y vuelta.");
          return false;
        }
        answers.fechaIda = ida;
        answers.fechaVuelta = vuelta;
      }

      if (step === 6) {
        const val = document.getElementById("ritmoSelect").value;
        if (!val && showAlerts) {
          alert("Por favor, indica cómo quieres el viaje.");
          return false;
        }
        answers.ritmo = val;
      }

      if (step === 7) {
        const val = document.getElementById("alojamientoSelect").value;
        if (!val && showAlerts) {
          alert("Por favor, elige el tipo de alojamiento.");
          return false;
        }
        answers.alojamiento = val;
      }

      return true;
    }

    function renderConditions() {
      personalPlanContainer.innerHTML = "";
      const box = document.createElement("div");
      box.className = "conditions-box";

      box.innerHTML = `
        <h3>Condiciones y envío del plan</h3>
        <p>Antes de finalizar, revisa estas condiciones:</p>
        <ul>
          <li>Tu viaje se generará de forma personalizada combinando IA y revisión humana.</li>
          <li>Recibirás la propuesta en un máximo de <strong>24 horas</strong> al correo indicado.</li>
          <li>Podrás responder a ese correo para solicitar ajustes o cambios.</li>
        </ul>
        <div class="conditions-actions">
          <input type="checkbox" id="condicionesCheck">
          <label for="condicionesCheck">Acepto estas condiciones y deseo recibir mi viaje en menos de 24h.</label>
        </div>
      `;

      const buttonsDiv = document.createElement("div");
      buttonsDiv.style.marginTop = "15px";

      const backBtn = document.createElement("button");
      backBtn.textContent = "Volver";
      backBtn.className = "back-btn";
      backBtn.onclick = () => {
        step = 7;
        renderQuestion();
      };

      const finishBtn = document.createElement("button");
      finishBtn.textContent = "Finalizar y enviar";
      finishBtn.className = "next-btn";
      finishBtn.onclick = () => {
        const check = document.getElementById("condicionesCheck").checked;
        if (!check) {
          alert("Debes aceptar las condiciones para continuar.");
          return;
        }
        sendEmailAndPdf();
      };

      buttonsDiv.appendChild(backBtn);
      buttonsDiv.appendChild(finishBtn);
      box.appendChild(buttonsDiv);

      personalPlanContainer.appendChild(box);
    }

    function buildBodyText() {
      return [
        "Nuevo cuestionario de viaje desde la web Explorando España:",
        "",
        `Nombre completo: ${answers.nombre}`,
        `Correo de contacto: ${answers.email}`,
        `Edad: ${answers.edad}`,
        `Destino deseado: ${answers.destino}`,
        `Número de viajeros: ${answers.personas}`,
        `Fecha de ida: ${answers.fechaIda}`,
        `Fecha de vuelta: ${answers.fechaVuelta}`,
        `Ritmo de viaje: ${answers.ritmo}`,
        `Tipo de alojamiento: ${answers.alojamiento}`,
        "",
        "Generar propuesta de viaje en menos de 24h."
      ].join("\n");
    }

    function sendEmailAndPdf() {
      const bodyText = buildBodyText();
      const subject = "Nuevo cuestionario de viaje - Explorando España";

      const mailtoLink =
        "mailto:" + encodeURIComponent(DESTINO_EMAIL) +
        "?subject=" + encodeURIComponent(subject) +
        "&body=" + encodeURIComponent(bodyText);

      window.location.href = mailtoLink;

      if (window.jspdf) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        let y = 10;
        const lines = bodyText.split("\n");
        doc.setFontSize(12);
        lines.forEach(line => {
          doc.text(line, 10, y);
          y += 7;
          if (y > 280) {
            doc.addPage();
            y = 10;
          }
        });
        doc.save("cuestionario-viaje.pdf");
      }

      personalPlanContainer.innerHTML = `
        <div id="confirmationMessage">
          <strong>¡Cuestionario enviado!</strong>
          <p>En menos de 24 horas recibirás tu propuesta de viaje personalizada en el correo <strong>${answers.email}</strong>.</p>
          <p>Si no te llega nada, puedes escribir a <strong>${DESTINO_EMAIL}</strong> indicando tu nombre y la fecha en la que rellenaste el formulario.</p>
        </div>
      `;
    }

    personalPlanBtn.addEventListener("click", () => {
      step = 0;
      renderQuestion();
    });
  </script>
</body>
</html>
