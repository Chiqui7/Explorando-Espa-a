<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Explorando España</title>

  <!-- Librería para generar PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    :root {
      --bg: #FDF5E6;          /* arena suave */
      --text: #1C3D5A;        /* azul mar */
      --accent: #77C9D4;      /* turquesa */
      --accent-dark: #57A99A; /* verde palmera */
      --success: #D4FFD8;     /* verde suave éxito */
      --card: #FFFFFF;
      --shadow: 0 2px 6px rgba(0,0,0,0.06);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      text-align: center;
    }

    h1 {
      margin-top: 20px;
      margin-bottom: 10px;
    }

    p.subtitle {
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 14px;
      opacity: 0.8;
    }

    button {
      padding: 14px 26px;
      margin: 10px;
      font-size: 18px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }

    #freePlanBtn {
      background: #E9DAC4;
      color: var(--text);
    }

    #personalPlanBtn {
      background: var(--accent);
      color: #ffffff;
    }

    .container {
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
    }

    .hidden {
      display: none;
    }

    /* PLAN GRATUITO */

    .ccaa-section {
      text-align: left;
      background: var(--card);
      padding: 15px;
      margin-top: 10px;
      border-radius: 8px;
      box-shadow: var(--shadow);
    }

    .ccaa-title {
      cursor: pointer;
      font-weight: bold;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .ccaa-title span {
      font-size: 18px;
    }

    .city-list {
      display: none;
      margin-left: 8px;
      margin-top: 8px;
    }

    .city {
      cursor: pointer;
      margin: 4px 0;
      color: var(--accent-dark);
      text-decoration: underline;
      text-decoration-style: dotted;
      font-size: 14px;
    }

    .info-box {
      margin-top: 10px;
      padding: 10px;
      background: #E5F7FA;
      border-radius: 6px;
      font-size: 13px;
    }

    /* PLAN PERSONALIZADO */

    .question-box {
      background: var(--card);
      padding: 20px;
      border-radius: 10px;
      margin-top: 30px;
      text-align: left;
      box-shadow: var(--shadow);
    }

    .question-box h3 {
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 18px;
    }

    .question-box label {
      font-size: 14px;
      display: block;
      margin-bottom: 5px;
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 4px;
      margin-bottom: 20px;
      border-radius: 6px;
      border: 1px solid #aaa;
      font-size: 14px;
    }

    .daterange {
      display: flex;
      gap: 10px;
    }

    .daterange div {
      flex: 1;
    }

    .back-btn {
      background: var(--text);
      color: white;
      margin-right: 10px;
      font-size: 16px;
    }

    .next-btn {
      background: var(--accent);
      color: white;
      font-size: 16px;
    }

    .conditions-box {
      background: var(--card);
      padding: 20px;
      border-radius: 10px;
      margin-top: 30px;
      text-align: left;
      box-shadow: var(--shadow);
      font-size: 14px;
    }

    .conditions-box ul {
      padding-left: 20px;
    }

    .conditions-box li {
      margin-bottom: 6px;
    }

    .conditions-actions {
      margin-top: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .conditions-actions input[type="checkbox"] {
      width: auto;
      margin: 0;
    }

    .conditions-actions label {
      margin: 0;
    }

    #confirmationMessage {
      margin-top: 20px;
      background: var(--success);
      padding: 20px;
      border-radius: 10px;
      font-size: 14px;
      text-align: left;
    }

    #confirmationMessage strong {
      display: block;
      margin-bottom: 6px;
    }

    iframe {
      width: 100%;
      height: 400px;
      border: 0;
      margin-top: 30px;
      border-radius: 10px;
    }

    @media (max-width: 600px) {
      .container {
        padding: 10px;
      }

      button {
        width: 90%;
        max-width: 320px;
      }

      .daterange {
        flex-direction: column;
      }
    }
  </style>
</head>

<body>

  <h1>Explorando España</h1>
  <p class="subtitle">Elige un plan para inspirarte o para crear tu viaje perfecto en menos de 24 horas.</p>

  <!-- BOTONES PRINCIPALES -->
  <button id="freePlanBtn">PLAN GRATUITO</button>
  <button id="personalPlanBtn">PLAN PERSONALIZADO</button>

  <!-- CONTENEDORES DE CADA PLAN -->
  <div id="freePlan" class="container hidden"></div>
  <div id="personalPlan" class="container hidden"></div>

  <!-- MAPA DE ESPAÑA, SIEMPRE ABAJO -->
  <iframe
    loading="lazy"
    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d4889502.373868815!2d-9.556876061667067!3d40.20847784486433!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0xd6b61b4f20bb6c3%3A0x10340f3c9caa480!2sEspaña!5e0!3m2!1ses!2ses!4v1700000000000">
  </iframe>

  <script>
    const DESTINO_EMAIL = "contacto.adriangilj@gmail.com";

    const freePlanBtn = document.getElementById("freePlanBtn");
    const personalPlanBtn = document.getElementById("personalPlanBtn");
    const freePlanContainer = document.getElementById("freePlan");
    const personalPlanContainer = document.getElementById("personalPlan");

    // ============================================================
    //   PLAN GRATUITO: CCAA + CIUDADES + INFO
    // ============================================================

    const ccaaData = {
      "Andalucía": [
        "Sevilla",
        "Málaga",
        "Cádiz",
        "Granada",
        "Córdoba",
        "Almería",
        "Huelva",
        "Jaén"
      ],
      "Cataluña": [
        "Barcelona",
        "Girona (Costa Brava)",
        "Tarragona (Costa Dorada)",
        "Lleida (Pirineo)"
      ],
      "Comunidad de Madrid": [
        "Madrid",
        "Sierra de Guadarrama"
      ],
      "Comunidad Valenciana": [
        "Valencia",
        "Alicante (Costa Blanca)",
        "Castellón",
        "Dénia"
      ],
      "País Vasco": [
        "Bilbao",
        "San Sebastián",
        "Vitoria-Gasteiz",
        "Costa vasca"
      ],
      "Galicia": [
        "Santiago de Compostela",
        "A Coruña",
        "Vigo (Rías Baixas)",
        "Lugo",
        "Ourense"
      ],
      "Islas Baleares": [
        "Mallorca",
        "Ibiza",
        "Menorca",
        "Formentera"
      ],
      "Islas Canarias": [
        "Tenerife",
        "Gran Canaria",
        "Lanzarote",
        "Fuerteventura",
        "La Palma"
      ],
      "Murcia": [
        "Murcia",
        "Cartagena",
        "La Manga"
      ],
      "Navarra": [
        "Pamplona",
        "Pirineo navarro"
      ],
      "Aragón": [
        "Zaragoza",
        "Huesca (Pirineo)",
        "Teruel"
      ],
      "Castilla y León": [
        "Salamanca",
        "Segovia",
        "Ávila",
        "León",
        "Burgos",
        "Valladolid"
      ],
      "Castilla-La Mancha": [
        "Toledo",
        "Cuenca",
        "Albacete",
        "Ciudad Real",
        "Guadalajara"
      ],
      "Asturias": [
        "Oviedo",
        "Gijón",
        "Cudillero",
        "Ribadesella"
      ],
      "Cantabria": [
        "Santander",
        "Picos de Europa (zona cántabra)"
      ],
      "La Rioja": [
        "Logroño",
        "Ruta del vino en La Rioja"
      ],
      "Extremadura": [
        "Cáceres",
        "Mérida",
        "Badajoz"
      ],
      "Ceuta y Melilla": [
        "Ceuta",
        "Melilla"
      ]
    };

    const cityInfo = {
      "Sevilla": `
        <strong>Actividades:</strong> Catedral y Giralda, Real Alcázar, Barrio de Santa Cruz, Plaza de España.<br>
        <strong>Hoteles:</strong> Casco histórico y zona centro con hoteles boutique y 3-4*.<br>
        <strong>Transporte:</strong> Todo a pie en el centro, tranvía y buses, AVE con Madrid.<br>
        <strong>Fiesta:</strong> Triana, Alameda, terrazas en el centro y tablaos de flamenco.
      `,
      "Málaga": `
        <strong>Actividades:</strong> Alcazaba, Castillo de Gibralfaro, Muelle Uno, museos y playas urbanas.<br>
        <strong>Hoteles:</strong> Hoteles de ciudad en el centro y resorts de playa en la costa.<br>
        <strong>Transporte:</strong> Aeropuerto internacional, tren de cercanías, autobuses frecuentes.<br>
        <strong>Fiesta:</strong> Centro histórico, Soho y chiringuitos con música.
      `,
      "Granada": `
        <strong>Actividades:</strong> Alhambra, Albaicín, miradores y rutas de tapas.<br>
        <strong>Hoteles:</strong> Zona centro y entorno de la Alhambra, gran variedad de precios.<br>
        <strong>Transporte:</strong> Ciudades cercanas y Sierra Nevada accesibles en bus o coche.<br>
        <strong>Fiesta:</strong> Bares de tapas y pubs en el centro.
      `,
      "Barcelona": `
        <strong>Actividades:</strong> Sagrada Familia, Park Güell, Casa Batlló, paseo marítimo y playas.<br>
        <strong>Hoteles:</strong> Eixample para moverse bien, zona playa para vacaciones de sol.<br>
        <strong>Transporte:</strong> Metro, buses y bici, ciudad muy bien conectada.<br>
        <strong>Fiesta:</strong> Bares y clubs en zonas como Eixample, Born y Barceloneta.
      `,
      "Madrid": `
        <strong>Actividades:</strong> Museo del Prado, Parque del Retiro, Palacio Real, barrios de Malasaña y La Latina.<br>
        <strong>Hoteles:</strong> Centro (Sol, Gran Vía) y barrios con encanto (Chamberí, Huertas).<br>
        <strong>Transporte:</strong> Metro y cercanías, no hace falta coche.<br>
        <strong>Fiesta:</strong> Azoteas, bares de copas y discotecas para todos los gustos.
      `,
      "Valencia": `
        <strong>Actividades:</strong> Ciudad de las Artes y las Ciencias, casco antiguo, playas de la Malvarrosa y Patacona.<br>
        <strong>Hoteles:</strong> Centro para combinar cultura y ocio, zona playa para vacaciones de mar.<br>
        <strong>Transporte:</strong> Metro, tranvía y carriles bici.<br>
        <strong>Fiesta:</strong> Ruzafa, Cánovas y locales frente al mar.
      `,
      "Alicante (Costa Blanca)": `
        <strong>Actividades:</strong> Castillo de Santa Bárbara, paseo marítimo, excursiones a la Costa Blanca.<br>
        <strong>Hoteles:</strong> Hoteles y apartamentos frente al mar, resorts en pueblos cercanos.<br>
        <strong>Transporte:</strong> Aeropuerto cercano, tranvía TRAM por la costa.<br>
        <strong>Fiesta:</strong> Zona de la Explanada y bares junto a la playa.
      `,
      "Dénia": `
        <strong>Actividades:</strong> Playas, puerto, rutas al Montgó, paseos en barco a Ibiza y Formentera.<br>
        <strong>Hoteles:</strong> Apartamentos y hoteles frente al mar, casas rurales en el interior.<br>
        <strong>Transporte:</strong> Coche muy recomendable, ferris a Baleares.<br>
        <strong>Fiesta:</strong> Terrazas junto al puerto y chiringuitos.
      `,
      "Ibiza": `
        <strong>Actividades:</strong> Calas y playas, atardeceres en San Antonio, Dalt Vila, rutas en barco.<br>
        <strong>Hoteles:</strong> Hoteles de playa, agroturismos en interior, villas privadas.<br>
        <strong>Transporte:</strong> Coche o moto para explorar bien la isla.<br>
        <strong>Fiesta:</strong> Clubs mundialmente conocidos y beach clubs, pero también zonas tranquilas.
      `,
      "Mallorca": `
        <strong>Actividades:</strong> Serra de Tramuntana, calas, Palma histórica, rutas en bici.<br>
        <strong>Hoteles:</strong> Resorts de playa, fincas rurales, hoteles boutique en el centro histórico.<br>
        <strong>Transporte:</strong> Coche muy recomendable para ver la isla.<br>
        <strong>Fiesta:</strong> Zonas animadas en Palma y calas con ambiente.
      `
      // El resto de ciudades usan un texto genérico:
    };

    function getGenericCityInfo(city) {
      return `
        <strong>Actividades:</strong> Paseo por el centro, visitas culturales y naturaleza de los alrededores.<br>
        <strong>Hoteles:</strong> Alojamiento en zona céntrica o en áreas tranquilas según el estilo de viaje.<br>
        <strong>Transporte:</strong> Recomendable combinar transporte público y coche de alquiler si quieres moverte por la región.<br>
        <strong>Ambiente:</strong> Bares y restaurantes locales para probar la gastronomía típica.
      `;
    }

    freePlanBtn.addEventListener("click", () => {
      freePlanContainer.innerHTML = "";
      freePlanContainer.classList.remove("hidden");
      personalPlanContainer.classList.add("hidden");

      for (let ccaa in ccaaData) {
        const section = document.createElement("div");
        section.className = "ccaa-section";

        const title = document.createElement("div");
        title.className = "ccaa-title";
        title.innerHTML = `<span>${ccaa}</span><span>+</span>`;

        const list = document.createElement("div");
        list.className = "city-list";

        ccaaData[ccaa].forEach(city => {
          const c = document.createElement("div");
          c.className = "city";
          c.textContent = city;

          c.addEventListener("click", () => {
            const info = document.createElement("div");
            info.className = "info-box";
            info.innerHTML = cityInfo[city] || getGenericCityInfo(city);
            list.appendChild(info);
          });

          list.appendChild(c);
        });

        title.addEventListener("click", () => {
          const isVisible = list.style.display === "block";
          list.style.display = isVisible ? "none" : "block";
          title.querySelectorAll("span")[1].textContent = isVisible ? "+" : "−";
        });

        section.appendChild(title);
        section.appendChild(list);
        freePlanContainer.appendChild(section);
      }
    });

    // ============================================================
    //   PLAN PERSONALIZADO: CUESTIONARIO PASO A PASO
    // ============================================================

    let step = 0;
    const answers = {
      nombre: "",
      email: "",
      edad: "",
      destino: "",
      personas: "",
      fechaIda: "",
      fechaVuelta: "",
      ritmo: "",
      alojamiento: ""
    };

    const destinosSelectOptions = (() => {
      const groups = [];
      groups.push({
        label: "Opción automática",
        options: ["Sitio aleatorio con propuestas según tu perfil"]
      });
      for (let ccaa in ccaaData) {
        groups.push({
          label: ccaa,
          options: ccaaData[ccaa]
        });
      }
      return groups;
    })();

    function renderQuestion() {
      personalPlanContainer.innerHTML = "";
      personalPlanContainer.classList.remove("hidden");
      freePlanContainer.classList.add("hidden");

      const box = document.createElement("div");
      box.className = "question-box";

      if (step === 0) {
        box.innerHTML = `
          <h3>1. Nombre completo</h3>
          <label>Escribe tu nombre completo para saber cómo dirigirnos a ti.</label>
          <input type="text" id="nombreInput" placeholder="Nombre y apellidos" value="${answers.nombre || ""}">
        `;
      }

      if (step === 1) {
        box.innerHTML = `
          <h3>2. Correo de contacto</h3>
          <label>Escribe tu correo. Ahí recibirás tu propuesta de viaje en PDF.</label>
          <input type="email" id="emailInput" placeholder="tucorreo@ejemplo.com" value="${answers.email || ""}">
        `;
      }

      if (step === 2) {
        box.innerHTML = `
          <h3>3. ¿Edad?</h3>
          <label>Elige tu rango de edad.</label>
          <select id="edadSelect">
            <option value="">Selecciona una opción</option>
            <option value="18-26">18-26</option>
            <option value="26-34">26-34</option>
            <option value="34-42">34-42</option>
            <option value="42-50">42-50</option>
            <option value="+50">+50</option>
          </select>
        `;
        if (answers.edad) {
          setTimeout(() => {
            document.getElementById("edadSelect").value = answers.edad;
          }, 0);
        }
      }

      if (step === 3) {
        const destWrapper = document.createElement("div");
        destWrapper.innerHTML = `
          <h3>4. ¿Qué deseas visitar?</h3>
          <label>Elige ciudad o zona. También puedes seleccionar un sitio aleatorio.</label>
        `;
        const select = document.createElement("select");
        select.id = "destinoSelect";
        const defaultOpt = document.createElement("option");
        defaultOpt.value = "";
        defaultOpt.textContent = "Selecciona un destino";
        select.appendChild(defaultOpt);

        destinosSelectOptions.forEach(group => {
          const optgroup = document.createElement("optgroup");
          optgroup.label = group.label;
          group.options.forEach(optText => {
            const opt = document.createElement("option");
            opt.value = optText;
            opt.textContent = optText;
            optgroup.appendChild(opt);
          });
          select.appendChild(optgroup);
        });

        destWrapper.appendChild(select);
        box.appendChild(destWrapper);

        if (answers.destino) {
          setTimeout(() => {
            document.getElementById("destinoSelect").value = answers.destino;
          }, 0);
        }
      }

      if (step === 4) {
        box.innerHTML = `
          <h3>5. ¿Cuántos viajan?</h3>
          <label>Elige el número total de personas.</label>
          <select id="personasSelect">
            <option value="">Selecciona</option>
            ${Array.from({length: 20}, (_, i) => `<option value="${i+1}">${i+1}</option>`).join("")}
          </select>
        `;
        if (answers.personas) {
          setTimeout(() => {
            document.getElementById("personasSelect").value = answers.personas;
          }, 0);
        }
      }

      if (step === 5) {
        box.innerHTML = `
          <h3>6. ¿Cuánto tiempo?</h3>
          <label>Selecciona fechas de ida y vuelta.</label>
          <div class="daterange">
            <div>
              <small>Fecha de ida</small>
              <input type="date" id="fechaIdaInput" value="${answers.fechaIda || ""}">
            </div>
            <div>
              <small>Fecha de vuelta</small>
              <input type="date" id="fechaVueltaInput" value="${answers.fechaVuelta || ""}">
            </div>
          </div>
        `;
      }

      if (step === 6) {
        box.innerHTML = `
          <h3>7. ¿Cómo quieres el viaje?</h3>
          <label>Elige el ritmo del viaje.</label>
          <select id="ritmoSelect">
            <option value="">Selecciona</option>
            <option value="Tranquilo">Tranquilo</option>
            <option value="Intenso">Intenso</option>
            <option value="Equilibrado">Equilibrado</option>
            <option value="No me importa">No me importa</option>
          </select>
        `;
        if (answers.ritmo) {
          setTimeout(() => {
            document.getElementById("ritmoSelect").value = answers.ritmo;
          }, 0);
        }
      }

      if (step === 7) {
        box.innerHTML = `
          <h3>8. ¿Dónde quieres pasar tu estancia?</h3>
          <label>Tipo de alojamiento preferido.</label>
          <select id="alojamientoSelect">
            <option value="">Selecciona</option>
            <option value="Hotel">Hotel</option>
            <option value="Airbnb">Airbnb</option>
            <option value="Villa">Villa</option>
          </select>
        `;
        if (answers.alojamiento) {
          setTimeout(() => {
            document.getElementById("alojamientoSelect").value = answers.alojamiento;
          }, 0);
        }
      }

      // Botones de navegación
      const buttonsDiv = document.createElement("div");

      if (step > 0) {
        const backBtn = document.createElement("button");
        backBtn.textContent = "Volver";
        backBtn.className = "back-btn";
        backBtn.onclick = () => {
          saveCurrentStep();
          step--;
          renderQuestion();
        };
        buttonsDiv.appendChild(backBtn);
      }

      const nextBtn = document.createElement("button");
      nextBtn.className = "next-btn";
      nextBtn.textContent = step === 7 ? "Ir a confirmar" : "Siguiente";

      nextBtn.onclick = () => {
        if (!saveCurrentStep(true)) return;

        if (step < 7) {
          step++;
          renderQuestion();
        } else {
          renderConditions();
        }
      };

      buttonsDiv.appendChild(nextBtn);
      box.appendChild(buttonsDiv);

      personalPlanContainer.appendChild(box);
    }

    function saveCurrentStep(showAlerts) {
      if (step === 0) {
        const val = document.getElementById("nombreInput").value.trim();
        if (!val && showAlerts) {
          alert("Por favor, escribe tu nombre completo.");
          return false;
        }
        answers.nombre = val;
      }

      if (step === 1) {
        const val = document.getElementById("emailInput").value.trim();
        if (!val && showAlerts) {
          alert("Por favor, escribe tu correo de contacto.");
          return false;
        }
        answers.email = val;
      }

      if (step === 2) {
        const val = document.getElementById("edadSelect").value;
        if (!val && showAlerts) {
          alert("Por favor, elige un rango de edad.");
          return false;
        }
        answers.edad = val;
      }

      if (step === 3) {
        const val = document.getElementById("destinoSelect").value;
        if (!val && showAlerts) {
          alert("Por favor, elige un destino o la opción aleatoria.");
          return false;
        }
        answers.destino = val;
      }

      if (step === 4) {
        const val = document.getElementById("personasSelect").value;
        if (!val && showAlerts) {
          alert("Por favor, indica cuántos viajan.");
          return false;
        }
        answers.personas = val;
      }

      if (step === 5) {
        const ida = document.getElementById("fechaIdaInput").value;
        const vuelta = document.getElementById("fechaVueltaInput").value;
        if ((!ida || !vuelta) && showAlerts) {
          alert("Por favor, selecciona fechas de ida y vuelta.");
          return false;
        }
        answers.fechaIda = ida;
        answers.fechaVuelta = vuelta;
      }

      if (step === 6) {
        const val = document.getElementById("ritmoSelect").value;
        if (!val && showAlerts) {
          alert("Por favor, indica cómo quieres el viaje.");
          return false;
        }
        answers.ritmo = val;
      }

      if (step === 7) {
        const val = document.getElementById("alojamientoSelect").value;
        if (!val && showAlerts) {
          alert("Por favor, elige el tipo de alojamiento.");
          return false;
        }
        answers.alojamiento = val;
      }

      return true;
    }

    function renderConditions() {
      personalPlanContainer.innerHTML = "";
      const box = document.createElement("div");
      box.className = "conditions-box";

      box.innerHTML = `
        <h3>Condiciones y envío del plan</h3>
        <p>Antes de finalizar, revisa estas condiciones:</p>
        <ul>
          <li>Tu viaje se generará de forma personalizada combinando IA y revisión humana.</li>
          <li>Recibirás la propuesta en un máximo de <strong>24 horas</strong> al correo indicado.</li>
          <li>Podrás responder a ese correo para solicitar ajustes o cambios.</li>
        </ul>
        <div class="conditions-actions">
          <input type="checkbox" id="condicionesCheck">
          <label for="condicionesCheck">Acepto estas condiciones y deseo recibir mi viaje en menos de 24h.</label>
        </div>
      `;

      const buttonsDiv = document.createElement("div");
      buttonsDiv.style.marginTop = "15px";

      const backBtn = document.createElement("button");
      backBtn.textContent = "Volver";
      backBtn.className = "back-btn";
      backBtn.onclick = () => {
        step = 7;
        renderQuestion();
      };

      const finishBtn = document.createElement("button");
      finishBtn.textContent = "Finalizar y enviar";
      finishBtn.className = "next-btn";
      finishBtn.onclick = () => {
        const check = document.getElementById("condicionesCheck").checked;
        if (!check) {
          alert("Debes aceptar las condiciones para continuar.");
          return;
        }
        sendEmailAndPdf();
      };

      buttonsDiv.appendChild(backBtn);
      buttonsDiv.appendChild(finishBtn);
      box.appendChild(buttonsDiv);

      personalPlanContainer.appendChild(box);
    }

    function buildBodyText() {
      return [
        "Nuevo cuestionario de viaje desde la web Explorando España:",
        "",
        `Nombre completo: ${answers.nombre}`,
        `Correo de contacto: ${answers.email}`,
        `Edad: ${answers.edad}`,
        `Destino deseado: ${answers.destino}`,
        `Número de viajeros: ${answers.personas}`,
        `Fecha de ida: ${answers.fechaIda}`,
        `Fecha de vuelta: ${answers.fechaVuelta}`,
        `Ritmo de viaje: ${answers.ritmo}`,
        `Tipo de alojamiento: ${answers.alojamiento}`,
        "",
        "Generar propuesta de viaje en menos de 24h."
      ].join("\n");
    }

    function sendEmailAndPdf() {
      const bodyText = buildBodyText();
      const subject = "Nuevo cuestionario de viaje - Explorando España";

      const mailtoLink =
        "mailto:" + encodeURIComponent(DESTINO_EMAIL) +
        "?subject=" + encodeURIComponent(subject) +
        "&body=" + encodeURIComponent(bodyText);

      // Abrir cliente de correo del usuario
      window.location.href = mailtoLink;

      // Generar PDF con jsPDF
      if (window.jspdf) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        let y = 10;
        const lines = bodyText.split("\n");
        doc.setFontSize(12);
        lines.forEach(line => {
          doc.text(line, 10, y);
          y += 7;
          if (y > 280) {
            doc.addPage();
            y = 10;
          }
        });
        doc.save("cuestionario-viaje.pdf");
      }

      // Mostrar mensaje de confirmación en la web
      personalPlanContainer.innerHTML = `
        <div id="confirmationMessage">
          <strong>¡Cuestionario enviado!</strong>
          <p>En menos de 24 horas recibirás tu propuesta de viaje personalizada en el correo <strong>${answers.email}</strong>.</p>
          <p>Si no te llega nada, puedes escribir a <strong>${DESTINO_EMAIL}</strong> indicando tu nombre y la fecha en la que rellenaste el formulario.</p>
        </div>
      `;
    }

    personalPlanBtn.addEventListener("click", () => {
      step = 0;
      renderQuestion();
    });
  </script>
</body>
</html>
